model TemplateBranch {
  id          String         @id @default(cuid())
  name        String
  description String?
  isDefault   Boolean        @default(false)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  template    FolderTemplate @relation(fields: [templateId], references: [id], onDelete: Cascade)
  templateId  String
  createdBy   User          @relation(fields: [createdById], references: [id])
  createdById String
  versions    TemplateVersion[]
  merges      BranchMerge[] @relation("SourceBranch")
  mergedInto  BranchMerge[] @relation("TargetBranch")

  @@unique([templateId, name])
  @@index([templateId])
  @@index([createdById])
}

model BranchMerge {
  id            String         @id @default(cuid())
  sourceBranch  TemplateBranch @relation("SourceBranch", fields: [sourceBranchId], references: [id])
  sourceBranchId String
  targetBranch  TemplateBranch @relation("TargetBranch", fields: [targetBranchId], references: [id])
  targetBranchId String
  mergedAt      DateTime       @default(now())
  mergedBy      User          @relation(fields: [mergedById], references: [id])
  mergedById    String
  conflicts     Json?
  resolution    Json?

  @@index([sourceBranchId])
  @@index([targetBranchId])
  @@index([mergedById])
}
